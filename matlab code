%% Created by Emily A. Thompson
% December 17, 2020
% Last Updated: December 19, 2020

close all;
clear all;

%% The DICOM Filename
folderFileName = '/Users/emilythompson/Desktop/CT LOD/zpafCsLOD.CT.Private_Layman.2259.3.2019.12.16.15.23.48.286.28536014.dcm';

%% Read in tha Image
image = dicomread(folderFileName); %uint16 format - only allows 2^16-1 values
dinfo = dicominfo(folderFileName);
img = double(image); %convert to double because we have more values than uint16 can handle

%% Display Image for Shits and Giggles
figure
imshow(img,[],'InitialMagnification','fit') %empty brackets tell it to display the maximum to minimum value. without them, the image appears totally black or white because it's only showing a portion of the value range. 
%Unsure if I like this initial magnification fit thing - TBD 

%% Draw ROIs
ROI1 = drawcircle('Label','ROI1', 'LineWidth',0.1, 'Color', 'b')
ROI2 = drawcircle('Label','ROI2', 'LineWidth',0.1, 'Color', 'r')
ROI3 = drawcircle('Label','ROI3', 'LineWidth',0.1, 'Color', 'y')
ROI4 = drawcircle('Label','ROI4', 'LineWidth',0.1, 'Color', 'm')
ROI5 = drawcircle('Label','ROI5', 'LineWidth',0.1, 'Color', 'c')
ROI6 = drawcircle('Label','ROI6', 'LineWidth',0.1, 'Color', 'g')
ROI7 = drawcircle('Label','ROI7', 'LineWidth',0.1, 'Color', 'w')
ROI8 = drawcircle('Label','ROI8', 'LineWidth',0.1, 'Color', 'k')

%% Calculate HU Values Within the ROI From DICOM Data
b = dinfo.RescaleIntercept;
m = dinfo.RescaleSlope;
HU = m .* img + b;

%HUImage = double(dicomread(folderFileName))*dinfo.RescaleSlope + dinfo.RescaleIntercept;


% extract mean HU:
values = myImage(ROI);
meanHU = mean(values)
